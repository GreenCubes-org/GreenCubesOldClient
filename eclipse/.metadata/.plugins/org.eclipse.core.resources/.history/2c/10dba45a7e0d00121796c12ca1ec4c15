// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.kpdus.com/jad.html
// Decompiler options: packimports(3) braces deadcode fieldsfirst 

package net.minecraft.src;

import java.util.*;

// Referenced classes of package net.minecraft.src:
//            Block, Item, NBTTagCompound, StatList, 
//            EntityPlayer, EnchantmentHelper, EntityLiving, World, 
//            NBTTagList, Enchantment, Entity, EnumAction, 
//            EnumRarity

public final class ItemStack {

	public int stackSize;
	public int animationsToGo;
	public int itemID;
	public NBTTagCompound field_40715_d;
	private int itemDamage;

	public ItemStack(Block block) {
		this(block, 1);
	}

	public ItemStack(Block block, int i) {
		this(block.blockID, i, 0);
	}

	public ItemStack(Block block, int i, int j) {
		this(block.blockID, i, j);
	}

	public ItemStack(Item item) {
		this(item.shiftedIndex, 1, 0);
	}

	public ItemStack(Item item, int i) {
		this(item.shiftedIndex, i, 0);
	}

	public ItemStack(Item item, int i, int j) {
		this(item.shiftedIndex, i, j);
	}

	public ItemStack(int i, int j, int k) {
		stackSize = 0;
		itemID = i;
		stackSize = j;
		itemDamage = k;
	}

	public static ItemStack loadItemStackFromNBT(NBTTagCompound nbttagcompound) {
		ItemStack itemstack = new ItemStack();
		itemstack.readFromNBT(nbttagcompound);
		return itemstack.getItem() == null ? null : itemstack;
	}

	private ItemStack() {
		stackSize = 0;
	}

	public ItemStack splitStack(int i) {
		ItemStack itemstack = new ItemStack(itemID, i, itemDamage);
		if(field_40715_d != null) {
			itemstack.field_40715_d = (NBTTagCompound) field_40715_d.func_40195_b();
		}
		stackSize -= i;
		return itemstack;
	}

	public Item getItem() {
		return Item.itemsList[itemID];
	}

	public int getIconIndex() {
		return getItem().getIconIndex(this);
	}

	public boolean useItem(EntityPlayer entityplayer, World world, int i, int j, int k, int l) {
		boolean flag = getItem().onItemUse(this, entityplayer, world, i, j, k, l);
		if(flag) {
			entityplayer.addStat(StatList.objectUseStats[itemID], 1);
		}
		return flag;
	}

	public float getStrVsBlock(Block block) {
		if(isBroken())
			return 0.0f;
		if(isInstabreak())
			return 50000000;
		return getItem().getStrVsBlock(this, block);
	}

	public ItemStack useItemRightClick(World world, EntityPlayer entityplayer) {
		return getItem().onItemRightClick(this, world, entityplayer);
	}

	public ItemStack onFoodEaten(World world, EntityPlayer entityplayer) {
		return getItem().onFoodEaten(this, world, entityplayer);
	}
	
	public boolean isUnbreakable() {
		return field_40715_d != null && field_40715_d.getBoolean("Unbreakable");
	}
	
	public boolean isUndropable() {
		return field_40715_d != null && field_40715_d.getBoolean("Undropable");
	}

	public NBTTagCompound writeToNBT(NBTTagCompound nbttagcompound) {
		nbttagcompound.setShort("id", (short) itemID);
		nbttagcompound.setByte("Count", (byte) stackSize);
		nbttagcompound.setShort("Damage", (short) itemDamage);
		if(field_40715_d != null) {
			nbttagcompound.setTag("tag", field_40715_d);
		}
		return nbttagcompound;
	}

	public void readFromNBT(NBTTagCompound nbttagcompound) {
		itemID = nbttagcompound.getShort("id");
		stackSize = nbttagcompound.getByte("Count");
		itemDamage = nbttagcompound.getShort("Damage");
		if(nbttagcompound.hasKey("tag")) {
			field_40715_d = nbttagcompound.getCompoundTag("tag");
		}
	}

	public int getMaxStackSize() {
		return getItem().getItemStackLimit();
	}

	public boolean isStackable() {
		return getMaxStackSize() > 1 && (!isItemStackDamageable() || !isItemDamaged());
	}

	public boolean isItemStackDamageable() {
		return Item.itemsList[itemID].getMaxDamage() > 0;
	}

	public boolean getHasSubtypes() {
		return Item.itemsList[itemID].getHasSubtypes();
	}

	public boolean isItemDamaged() {
		return isItemStackDamageable() && itemDamage > 0;
	}

	public int getItemDamageForDisplay() {
		return itemDamage;
	}

	public int getItemDamage() {
		return itemDamage;
	}

	public void setItemDamage(int i) {
		itemDamage = i;
	}

	public int getMaxDamage() {
		return Item.itemsList[itemID].getMaxDamage();
	}

	public void damageItem(int i, EntityLiving entityliving) {
		if(!isItemStackDamageable() || isBroken()) {
			return;
		}
		if(field_40715_d != null && field_40715_d.getBoolean("Invulnerable"))
			return;
		if(i > 0 && (entityliving instanceof EntityPlayer)) {
			int j = EnchantmentHelper.getUnbreakingModifier(((EntityPlayer) entityliving).inventory);
			if(j > 0 && entityliving.worldObj.rand.nextInt(j + 1) > 0) {
				return;
			}
		}
		itemDamage += i;
		if(itemDamage > getMaxDamage()) {
			entityliving.func_41005_b(this);
			if(entityliving instanceof EntityPlayer) {
				((EntityPlayer) entityliving).addStat(StatList.objectBreakStats[itemID], 1);
			}
			if(!isUnbreakable()) {
				stackSize--;
				if(stackSize < 0) {
					stackSize = 0;
				}
				itemDamage = 0;
			}
		}
	}

	public void hitEntity(EntityLiving entityliving, EntityPlayer entityplayer) {
		boolean flag = Item.itemsList[itemID].hitEntity(this, entityliving, entityplayer);
		if(flag) {
			entityplayer.addStat(StatList.objectUseStats[itemID], 1);
		}
	}

	public void onDestroyBlock(int i, int j, int k, int l, EntityPlayer entityplayer) {
		boolean flag = Item.itemsList[itemID].onBlockDestroyed(this, i, j, k, l, entityplayer);
		if(flag) {
			entityplayer.addStat(StatList.objectUseStats[itemID], 1);
		}
	}

	public int getDamageVsEntity(Entity entity) {
		if(isBroken())
			return 0;
		return Item.itemsList[itemID].getDamageVsEntity(entity);
	}

	public boolean canHarvestBlock(Block block) {
		if(isBroken())
			return false;
		return Item.itemsList[itemID].canHarvestBlock(block);
	}

	public void onItemDestroyedByUse(EntityPlayer entityplayer) {
	}

	public void useItemOnEntity(EntityLiving entityliving) {
		Item.itemsList[itemID].useItemOnEntity(this, entityliving);
	}

	public ItemStack copy() {
		ItemStack itemstack = new ItemStack(itemID, stackSize, itemDamage);
		if(field_40715_d != null) {
			itemstack.field_40715_d = (NBTTagCompound) field_40715_d.func_40195_b();
			if(!itemstack.field_40715_d.equals(field_40715_d)) {
				return itemstack;
			}
		}
		return itemstack;
	}

	public static boolean areItemStacksEqual(ItemStack itemstack, ItemStack itemstack1) {
		if(itemstack == null && itemstack1 == null) {
			return true;
		}
		if(itemstack == null || itemstack1 == null) {
			return false;
		} else {
			return itemstack.isItemStackEqual(itemstack1);
		}
	}

	// GreenCubes start
	public static boolean canStackItems(ItemStack i1, ItemStack i2) {
		if(!areItemStackContentEqual(i1, i2))
			return false;
		if(i1 != null) {
			if(i1.field_40715_d != null && i1.field_40715_d.hasKey("nostack"))
				return false;
			if(i2.field_40715_d != null && i2.field_40715_d.hasKey("nostack"))
				return false;
		}
		return true;
	}

	public static boolean areItemStackContentEqual(ItemStack i1, ItemStack i2) {
		if(i1 == null && i2 == null) {
			return true;
		}
		if(i1 == null || i2 == null) {
			return false;
		} else {
			return i1.isItemStackContentEqual(i2);
		}
	}

	private boolean isItemStackContentEqual(ItemStack itemstack) {
		if(itemID != itemstack.itemID) {
			return false;
		}
		if(itemDamage != itemstack.itemDamage) {
			return false;
		}
		if(field_40715_d == null && itemstack.field_40715_d != null) {
			return false;
		}
		return field_40715_d == null || field_40715_d.equals(itemstack.field_40715_d);
	}

	// GreenCubes end

	private boolean isItemStackEqual(ItemStack itemstack) {
		if(stackSize != itemstack.stackSize) {
			return false;
		}
		if(itemID != itemstack.itemID) {
			return false;
		}
		if(itemDamage != itemstack.itemDamage) {
			return false;
		}
		if(field_40715_d == null && itemstack.field_40715_d != null) {
			return false;
		}
		return field_40715_d == null || field_40715_d.equals(itemstack.field_40715_d);
	}

	public boolean isItemEqual(ItemStack itemstack) {
		return itemID == itemstack.itemID && itemDamage == itemstack.itemDamage;
	}

	public static ItemStack copyItemStack(ItemStack itemstack) {
		return itemstack != null ? itemstack.copy() : null;
	}

	public String toString() {
		return (new StringBuilder()).append(stackSize).append("x").append(Item.itemsList[itemID].getItemName()).append("@").append(itemDamage).toString();
	}

	public void updateAnimation(World world, Entity entity, int i, boolean flag) {
		if(animationsToGo > 0) {
			animationsToGo--;
		}
		Item.itemsList[itemID].onUpdate(this, world, entity, i, flag);
	}

	public void onCrafting(World world, EntityPlayer entityplayer) {
		entityplayer.addStat(StatList.objectCraftStats[itemID], stackSize);
		Item.itemsList[itemID].onCreated(this, world, entityplayer);
	}

	public boolean isStackEqual(ItemStack itemstack) {
		return itemID == itemstack.itemID && stackSize == itemstack.stackSize && itemDamage == itemstack.itemDamage;
	}

	public int getMaxItemUseDuration() {
		return getItem().getMaxItemUseDuration(this);
	}

	public EnumAction getItemUseAction() {
		return getItem().getItemUseAction(this);
	}

	public void onPlayerStoppedUsing(World world, EntityPlayer entityplayer, int i) {
		getItem().onPlayerStoppedUsing(this, world, entityplayer, i);
	}

	public boolean func_40710_n() {
		return field_40715_d != null;
	}

	public NBTTagCompound func_40709_o() {
		return field_40715_d;
	}

	public NBTTagList func_40714_p() {
		if(field_40715_d == null) {
			return null;
		} else {
			return (NBTTagList) field_40715_d.func_40196_b("ench");
		}
	}

	public void func_40706_d(NBTTagCompound nbttagcompound) {
		if(Item.itemsList[itemID].getItemStackLimit() != 1) {
			throw new IllegalArgumentException("Cannot add tag data to a stackable item");
		} else {
			field_40715_d = nbttagcompound;
			return;
		}
	}
	
	/**
	 * GreenCubes name function
	 * @return item name for displaying
	 */
	private String getName() {
		if(field_40715_d == null)
			return getItem().func_40397_d(this);
		StringBuilder sb = new StringBuilder();
		if(field_40715_d.hasKey("NameColor"))
			sb.append(field_40715_d.getString("NameColor"));
		if(field_40715_d.hasKey("NamePrefix"))
			sb.append(field_40715_d.getString("NamePrefix")).append(' ');
		if(field_40715_d.hasKey("Name"))
			sb.append(field_40715_d.getString("Name"));
		else
			sb.append(getItem().func_40397_d(this));
		if(field_40715_d.hasKey("NameSuffix"))
			sb.append(' ').append(field_40715_d.getString("NameSuffix")).append(' ');
		return sb.toString();
	}
	
	public boolean isInstabreak() {
		return field_40715_d != null && field_40715_d.getBoolean("Instabreak");
	}
	
	public boolean isBroken() {
		return isItemStackDamageable() && isUnbreakable() && itemDamage >= getItem().getMaxDamage();
	}

	public List func_40712_q() {
		ArrayList arraylist = new ArrayList();
		Item item = Item.itemsList[itemID];
		arraylist.add(getName());
		item.func_40404_a(this, arraylist);
		if(func_40710_n()) {
			// GreenCubes start
			StringBuilder title = new StringBuilder();
			if(field_40715_d.hasKey("title")) {
				title.append(field_40715_d.getString("title"));
				if(field_40715_d.hasKey("synchronized") && field_40715_d.getBoolean("synchronized")) {
					title.append("\2477 (Связана)");
				}
			}
			if(title.length() > 0)
				arraylist.add(title.toString());
			if(field_40715_d.hasKey("Subtitles")) {
				NBTTagList list = (NBTTagList) field_40715_d.func_40196_b("Subtitles");
				for(int i = 0; i < list.tagCount(); ++i)
					arraylist.add(((NBTTagString) list.tagAt(i)).stringValue);
			}
			// GreenCubes end
			NBTTagList nbttaglist = func_40714_p();
			if(nbttaglist != null) {
				for(int i = 0; i < nbttaglist.tagCount(); i++) {
					short word0 = ((NBTTagCompound) nbttaglist.tagAt(i)).getShort("id");
					short word1 = ((NBTTagCompound) nbttaglist.tagAt(i)).getShort("lvl");
					if(Enchantment.enchantmentsList[word0] != null) {
						arraylist.add(Enchantment.enchantmentsList[word0].getTranslatedName(word1));
					}
				}
			}
			// \247rffaaffff
			if(field_40715_d.getBoolean("Undropable"))
				arraylist.add("\2477Нельзя выбросить");
			if(field_40715_d.hasKey("Glow"))
				arraylist.add("\247rffb428faС эффектом свечения");
			if(field_40715_d.getBoolean("Unbreakable"))
				arraylist.add("\247rffaaffffНельзя уничтожить");
			if(field_40715_d.getBoolean("Invulnerable"))
				arraylist.add("\247rffaaffffНе повреждается");
			if(field_40715_d.getBoolean("Instabreak"))
				arraylist.add("\247rffaaffffМгновенное ломание блоков");
		}
		return arraylist;
	}

	public boolean func_40713_r() {
		return (field_40715_d != null && field_40715_d.hasKey("Glow")) || getItem().func_40403_e(this);
	}

	public EnumRarity func_40707_s() {
		return getItem().func_40398_f(this);
	}

	public boolean func_40708_t() {
		if(!getItem().func_40401_i(this)) {
			return false;
		}
		return !func_40711_u();
	}

	public void addEnchantment(Enchantment enchantment, int i) {
		if(field_40715_d == null) {
			func_40706_d(new NBTTagCompound());
		}
		if(!field_40715_d.hasKey("ench")) {
			field_40715_d.setTag("ench", new NBTTagList("ench"));
		}
		NBTTagList nbttaglist = (NBTTagList) field_40715_d.func_40196_b("ench");
		NBTTagCompound nbttagcompound = new NBTTagCompound();
		nbttagcompound.setShort("id", (short) enchantment.effectId);
		nbttagcompound.setShort("lvl", (byte) i);
		nbttaglist.setTag(nbttagcompound);
	}

	public boolean func_40711_u() {
		return field_40715_d != null && field_40715_d.hasKey("ench");
	}
}
